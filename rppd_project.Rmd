---
title: "Untitled"
author: 'team id: 160'
date: "2024-06-01"
output: html_document
---

```{r beggining}
library(dplyr)
library(readxl)
library(readr)
library(ggplot2)
library(GGally)
library(jsonlite)
library(tidyr)
```

```{r prepare}
data <- read_csv("C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv")

data$isRadiant = as.integer(!is.na(data$isRadiant))
data$player_slot = NULL
data$account_id = NULL
data$additional_units = NULL
data$patch = NULL
data$region = NULL
data$account_id = NULL
data$lose = NULL
data$radiant_win = NULL
data$...1 = NULL
data = data %>% filter(`game_mode` == 2)

```

Q1 = в данном датасете осталось 200309 униальных матчей
```{r q1}
heroes <- read_csv("C:\\Users\\Егор\\Downloads\\rppd\\heroes.csv")

uniq_match <- n_distinct(data$match_id)
uniq_match
```

Q2
Мы можем удалить переменную gold_spent, так как она не оказывает никакого влияния на нашу основную переменную GPM. Более того, gold_spent не имеет никакой связи с иными колонками в  data. Мы не можем сделать никаких выводов благодаря ей, в следствие чего она является информационным мусором и ее можно удалить для оптимизации просмотра данных.
```{r q2}
data$gold_spent = NULL
names(heroes)[names(heroes)== 'id']='hero_id'
dota2_data = merge(x = data, y = heroes, by = "hero_id", sort = T)


```

Q3
```{r q3}
max(dota2_data$gold_per_min, na.rm=T)
id1 <- dota2_data[dota2_data$gold_per_min == '1315',]
id1$hero_id

```

Q4
```{r q4}
agi <- dota2_data %>% filter(dota2_data$primary_attr == 'agi')
max(agi$gold_per_min, na.rm=T)
id2 <- agi[agi$gold_per_min == '1315',]
id2$hero_id
```

Q5.1
```{r q5}
melee <- dota2_data %>% filter(dota2_data$attack_type == 'Melee')
ranged <- dota2_data %>% filter(dota2_data$attack_type == 'Ranged')
mean(melee$gold_per_min)
mean(ranged$gold_per_min)
mean(melee$gold_per_min) > mean(ranged$gold_per_min)
```
Q5.2
В данной задаче по-моему мнению предпочтительнее использовать функцию mean, так как это даст возможность более детально провести расчет и  учесть каждое число. Это является важным в данной ситуации, так как мы обязаны расмотреть все переменные, чтобы исключить необоснованный разрыв в значениях между двумя переменными. Среднее значение и Медианное значение в данном случае не сильно отличаются. Однако в иных случаях , отличие могут быть колосальными.

Q6
```{r q6}
dota2_data$kills_log <- lapply(dota2_data$kills_log, function(x) {
  tryCatch(
    fromJSON(gsub("'", '"', x)),  
    error = function(e) data.frame(time = numeric(), key = numeric())  
  )
})


time_values <- c()
median_free_times <- c()

for (i in 1:nrow(dota2_data)) {
  if (length(dota2_data$kills_log[[i]]) == 0) {
    median_free_time <- dota2_data$duration[i]
  } else {
    time_values <- dota2_data$kills_log[[i]]$time
    time_diff <- c(0, diff(time_values))
    median_free_time <- median(time_diff, na.rm = TRUE)
  }
  
  median_free_times <- c(median_free_times, median_free_time)
}

mean_median_free_time <- mean(median_free_times, na.rm = TRUE)

median_free_times[is.na(median_free_times)] <- mean_median_free_time
dota2_data$median_free_time <- median_free_times
print(median_free_time)
```

Q7
```{r q7}

# Загрузка данных из JSON-файла
level_exp <- fromJSON("C:\\Users\\Егор\\Downloads\\rppd\\level_exp.json")

# Создание переменной exp и удаление переменной level
dota2_data <- dota2_data %>%
  mutate(exp = level_exp[as.character(level)]) %>%
  select(-level)

# Удаление матчей с пропусками в переменной lane
dota2_data <- dota2_data %>%
  group_by(match_id) %>%
  filter(!any(is.na(lane))) %>%
  ungroup()

# Создание бинарных переменных из lane, primary_attr и attack_type, и удаление оригинальных переменных
dota2_data <- dota2_data %>%
  mutate(
    lane_1 = ifelse(lane == 1, 1, 0),
    lane_2 = ifelse(lane == 2, 1, 0),
    lane_3 = ifelse(lane == 3, 1, 0),
    str_attr = ifelse(primary_attr == "str", 1, 0),
    agi_attr = ifelse(primary_attr == "agi", 1, 0),
    int_attr = ifelse(primary_attr == "int", 1, 0),
    all_attr = ifelse(primary_attr == "all", 1, 0),
    melee_attack = ifelse(attack_type == "Melee", 1, 0),
    ranged_attack = ifelse(attack_type == "Ranged", 1, 0)
  ) %>%
  select(-lane, -primary_attr, -attack_type)
```

Q8
```{r q8}
# Замена значений teamfight_participation > 1 на 1
dota2_data <- dota2_data %>%
  mutate(teamfight_participation = ifelse(teamfight_participation > 1, 1, teamfight_participation))

# Вычисление среднего значения teamfight_participation
mean_teamfight_participation <- mean(data$teamfight_participation, na.rm = TRUE)

# Вычисление медианного значения teamfight_participation
median_teamfight_participation <- median(data$teamfight_participation, na.rm = TRUE)

# Вывод результатов
print(paste(mean_teamfight_participation))
print(paste(median_teamfight_participation))

# Выбор меры центральной тенденции
if (mean_teamfight_participation < median_teamfight_participation) {
  print("Медианное значение более устойчиво к выбросам и лучше отражает центральную тенденцию, особенно в случаях, когда данные могут содержать экстремальные значения. Среднее значение может быть сильно искажено выбросами, в то время как медиана показывает центральное значение распределения, независимо от наличия выбросов.")
} else {
  print("Среднее значение может быть использовано, если распределение данных не имеет значительных выбросов.")
}

dota2_data$last_hits<- dota2_data$neutral_kills + dota2_data$lane_kills
nonancient_kills <- dota2_data$neutral_kills - dota2_data$ancient_kills
dota2_data$nonancient_kills <- nonancient_kills
dota2_data$neutral_kills = NULL

dota2_data$healing_zero <- ifelse(dota2_data$hero_healing == 0, 1, 0)
dota2_data$exp_zero <- ifesle(dota2_data$exp == 0, 1, 0)
```

Q9.1
```{r q9.1}
cor.test(dota2_data$kills, dota2_data$gold_per_min)
```

Корреляция значима. Значение p-value равно приблизительно 0.

Q9.2

```{r q9.2}
e = 2.7182818284
xyi <- log(1 + dota2_data$kills, e)
cor.test(xyi, dota2_data$gold_per_min)
```

Корреляция уменьшилась на одну сотую, но осталась все также значимой

Q10
```{r q10.1}
# Выбор переменных для анализа
variables <- c("kills", "deaths", "assists", "gold_per_min")

# Проверка нормальности распределения с помощью гистограмм и Q-Q графиков
for (var in variables) {
  p1 <- ggplot(dota2_data, aes(x = !!sym(var))) + 
    geom_histogram(bins = 30, fill = "blue", alpha = 0.7) +
    ggtitle(paste("Histogram of", var))
  
  p2 <- ggplot(dota2_data, aes(sample = !!sym(var))) + 
    stat_qq() + 
    stat_qq_line() +
    ggtitle(paste("Q-Q Plot of", var))
  
  print(p1)
  print(p2)
}

# Проверка с помощью теста Шапиро-Уилка
shapiro_test <- function(x) {
  if (length(x) > 5000) {
    x <- sample(x, 5000)
  }
  shapiro.test(x)$p.value
}

shapiro_results <- sapply(dota2_data[variables], shapiro_test)
shapiro_results
```
Ответ на Q10.1
Исходя из визуализаций и p-значений теста, делаем вывод о нормальности распределения переменных. Если p-значение меньше 0.05, то распределение отклоняется от нормального.

```{r q10.2}
# Применение логарифмической и корневых трансформаций
log_transformed <- dota2_data %>%
  mutate(across(all_of(variables), ~log1p(.)))

sqrt_transformed <- dota2_data %>%
  mutate(across(all_of(variables), ~sqrt(.)))

# Проверка нормальности после трансформаций
log_shapiro_results <- sapply(log_transformed[variables], shapiro_test)
sqrt_shapiro_results <- sapply(sqrt_transformed[variables], shapiro_test)

log_shapiro_results
sqrt_shapiro_results

# Визуализация гистограмм и Q-Q графиков после трансформаций
for (var in variables) {
  p1 <- ggplot(log_transformed, aes(x = !!sym(var))) + 
    geom_histogram(bins = 30, fill = "green", alpha = 0.7)
  
  p2 <- ggplot(log_transformed, aes(sample = !!sym(var))) + 
    stat_qq() + 
    stat_qq_line()
  
  print(p1)
  print(p2)
  
  p3 <- ggplot(sqrt_transformed, aes(x = !!sym(var))) + 
    geom_histogram(bins = 30, fill = "red", alpha = 0.7)
  
  p4 <- ggplot(sqrt_transformed, aes(sample = !!sym(var))) + 
    stat_qq() + 
    stat_qq_line()
  
  print(p3)
  print(p4)
}

```

Ответ на Q10.2
После применения логарифмической и корневых изменений, можно сравнить p-значения теста до и после трансформаций. Если p-значения увеличились и стали больше 0.05, то распределение стало ближе к нормальному.

Q11.1

```{r q11.1}
# Визуализация распределения gold_per_min
ggplot(dota2_data, aes(x = gold_per_min)) + 
  geom_density(fill = "blue", alpha = 0.5) +
  ggtitle("абоб1")

# Проверка распределения gold_per_min по различным переменным
potential_vars <- c("hero_id", "lane_1", "lane_2", "lane_3", "str_attr", "agi_attr", "int_attr", "melee_attack", "ranged_attack")

# Функция для создания плотностей по группам
plot_density_by_group <- function(data, var, target) {
  p <- ggplot(data, aes_string(x = target, color = var)) + 
    geom_density(alpha = 0.5)
  print(p)
}

# Применение функции к переменным
for (var in potential_vars) {
  plot_density_by_group(dota2_data, var, "gold_per_min")
}
```

После анализа графиков плотности, видно, что разбиение по переменным lane_1, lane_2, и lane_3 не устраняет бимодальность в распределении gold_per_min. Это говорит о том, что другие переменные, такие как hero_id или другие характеристики героев, могут более эффективно влиять на устранение бимодальности.



Q11.2

```{r q11.2}
# Визуализация распределения last_hits
ggplot(dota2_data, aes(x = last_hits)) + 
  geom_density(fill = "blue", alpha = 0.5)
# Проверка распределения last_hits по различным переменным
# Используем те же potential_vars, что и в Q11.1
# Применение функции к переменным для last_hits
for (var in potential_vars) {
  plot_density_by_group(dota2_data, var, "last_hits")
}
```

Аналогично,разделениепопеременнойlane_1не устраняет бимодальностьраспределенияlast_hits. Это также указывает на то, что другие переменные, такие как hero_idидругиесвойствагероя,могут быть более полезными для устранения бимодальности.

 Q12.1, Q12.2 и Q12.3

```{r q12}
dota2_data <- read.csv("C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv")
dota2_data <- dota2_data %>%
  select(-c(X, player_slot, account_id, additional_units, patch, region, lose, radiant_win))
dota2_data <- dota2_data %>%
  filter(game_mode == 2) %>%
  na.omit()
heroes_data <- read.csv("C:\\Users\\Егор\\Downloads\\rppd\\heroes.csv")
heroes_data <- heroes_data %>%
  rename(hero_id = id)
dota2_data <- dota2_data %>%
  left_join(heroes_data, by = "hero_id")
dota2_data <- dota2_data %>%
  mutate(
    kda_ratio = ifelse(deaths == 0, kills + assists, (kills + assists) / deaths),
    exp = case_when(
      level == 1 ~ 0,
      level == 2 ~ 240,
      level == 3 ~ 640,
      level == 4 ~ 1160,
      level == 5 ~ 1760,
      level == 6 ~ 2440,
      level == 7 ~ 3200,
      level == 8 ~ 4000,
      level == 9 ~ 4900,
      level == 10 ~ 5900,
      level == 11 ~ 7000,
      level == 12 ~ 8200,
      level == 13 ~ 9500,
      level == 14 ~ 10900,
      level == 15 ~ 12400,
      level == 16 ~ 14000,
      level == 17 ~ 15700,
      level == 18 ~ 17500,
      level == 19 ~ 19400,
      level == 20 ~ 21400,
      level == 21 ~ 23600,
      level == 22 ~ 26000,
      level == 23 ~ 28600,
      level == 24 ~ 31400,
      level == 25 ~ 34400,
      level == 26 ~ 38400,
      level == 27 ~ 43400,
      level == 28 ~ 49400,
      level == 29 ~ 56400,
      level == 30 ~ 63900
    )
  )


correlations <- cor(dota2_data[, c("gold_per_min", "last_hits", "kills", "exp")], use = "complete.obs")
top_correlations <- correlations["gold_per_min", ][-1]
top_3_vars <- sort(top_correlations, decreasing = TRUE)[1:3]
cat("Q12.1: Три переменные с наибольшей корреляцией с gold_per_min: ", paste(names(top_3_vars), collapse = ", "), "\n")

# Проверка значимости корреляций
p_values <- sapply(names(top_3_vars), function(var) {
  cor.test(dota2_data$gold_per_min, dota2_data[[var]])$p.value
})
cat("Q12.2: p-values для переменных: ", paste(p_values, collapse = ", "), "\n")

# Проверка корреляций между переменными
cor_matrix <- cor(dota2_data[, names(top_3_vars)], use = "complete.obs")
cat("Q12.3: Корреляции между топ-3 переменными: \n")
print(cor_matrix)
```

Q12.1
Наибольшую корреляцию с показателем gold_per_min имеют следующие переменные:

last_hits (0.7529873)

kills (0.4255873)

exp (0.5713789)

Эти переменные имеют самые высокие коэффициенты корреляции с gold_per_min.

Q12.2 
last_hits: p-value = 0

kills: p-value = 0

exp: p-value = 0

Все три переменные имеют p-value, равное 0, что значительно меньше уровня значимости α=0.05. Это означает, что все три корреляции являются статистически значимыми, и мы можем с высокой степенью уверенности утверждать, что существует связь между этими переменными и gold_per_min.

Q12.3: Обнаружили ли вы статистически значимые корреляции между какими-либо переменными из этого топа? Если да, как вы думаете, с чем это может быть связано?
Корреляции между топ-3 переменными:

Корреляция между last_hits и kills: 0.4255873

Корреляция между last_hits и exp: 0.7529873

Корреляция между kills и exp: 0.5713789

Все корреляции между топ-3 переменными являются статистически значимыми (p-value < 0.05). Высокие значения корреляции между этими переменными могут быть объяснены тем, что они взаимосвязаны в контексте игры:

last_hits и exp: Высокая корреляция между last_hits и exp объясняется тем, что убийства крипов (last_hits) непосредственно влияют на получение опыта (exp). Чем больше крипов игрок убивает, тем больше опыта он получает.

kills и exp: Корреляция между kills и exp объясняется тем, что убийство вражеских героев также приносит значительное количество опыта.

last_hits и kills: Корреляция между last_hits и kills может быть связана с тем, что игроки, которые активно добивают крипов, часто участвуют и в убийствах вражеских героев, что приводит к увеличению показателя kills.

Q13

``` {r q13}
dota2_data <- read.csv("C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv")
level_exp <- fromJSON("C:\\Users\\Егор\\Downloads\\rppd\\level_exp.json")
level_exp_df <- data.frame(level = as.numeric(names(level_exp)), exp = unlist(level_exp))
dota2_data <- dota2_data %>%
  left_join(level_exp_df, by = c("level" = "level")) %>%
  select(-level)
dota2_data <- dota2_data %>%
  mutate(
    lane_1 = ifelse(lane == 1, 1, 0),
    lane_2 = ifelse(lane == 2, 1, 0),
    lane_3 = ifelse(lane == 3, 1, 0)
  ) %>%
  select(-lane)

central_lane_data <- dota2_data %>% filter(lane_2 == 1)

side_lane_data <- dota2_data %>% filter(lane_2 == 0)

# Вычисление корреляций и их значимости для central_lane_data
central_correlations <- cor(central_lane_data %>% select(gold_per_min, last_hits, kills, exp), use = "complete.obs")

central_p_values <- sapply(names(central_correlations)[-1], function(var) {
  cor_test <- cor.test(central_lane_data[[var]], central_lane_data$gold_per_min)
  return(c(cor = cor_test$estimate, p.value = cor_test$p.value))
})

# Вычисление корреляций и их значимости для side_lane_data
side_correlations <- cor(side_lane_data %>% select(gold_per_min, last_hits, kills, exp), use = "complete.obs")

side_p_values <- sapply(names(side_correlations)[-1], function(var) {
  cor_test <- cor.test(side_lane_data[[var]], side_lane_data$gold_per_min)
  return(c(cor = cor_test$estimate, p.value = cor_test$p.value))
})

# Результаты для центральной линии
cat("Корреляции для центральной линии (lane_2 = 1):\n")
print(central_correlations)
cat("\nP-values для центральной линии (lane_2 = 1):\n")
print(central_p_values)

# Результаты для боковых линий
cat("Корреляции для боковых линий (lane_2 = 0):\n")
print(side_correlations)
cat("\nP-values для боковых линий (lane_2 = 0):\n")
print(side_p_values)


```
Q13.1

На центральной линии (lane_2 = 1) переменные с наибольшей корреляцией с gold_per_min:

kills (корреляция 0.6941594)
exp (корреляция 0.6743608)
last_hits (корреляция 0.6309236)
Значимости корреляций (p-values):

Для центральной линии:

kills: p-value < 2.2e-16
exp: p-value < 2.2e-16
last_hits: p-value < 2.2e-16

Q13.2

На боковых линиях (lane_2 = 0) переменные с наибольшей корреляцией с gold_per_min:

last_hits (корреляция 0.8439113)
exp (корреляция 0.6791351)
kills (корреляция 0.6779185)
Значимости корреляций (p-values):

Для боковых линий:

last_hits: p-value < 2.2e-16
exp: p-value < 2.2e-16
kills: p-value < 2.2e-16

Q13.3

Да, результаты отличаются. Для центральной линии kills и exp имеют более высокие корреляции с gold_per_min, чем last_hits, в то время как на боковых линиях last_hits имеет наибольшую корреляцию с gold_per_min.
Различия могут быть связаны с различными ролями и стратегиями игры на центральной и боковых линиях. Герои на центральной линии часто играют агрессивнее и получают золото через убийства и участие в сражениях, тогда как герои на боковых линиях больше сосредоточены на фарме крипов.

Q 14

``` {r q14}
dota2_data <- read.csv("C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv")
dota2_data <- dota2_data %>%
  select(-c(X, player_slot, account_id, additional_units, patch, region, lose, radiant_win))
dota2_data <- dota2_data %>%
  filter(game_mode == 2) %>%
  na.omit()
heroes_data <- read.csv("C:\\Users\\Егор\\Downloads\\rppd\\heroes.csv")
heroes_data <- heroes_data %>%
  rename(hero_id = id)
dota2_data <- dota2_data %>%
  left_join(heroes_data, by = "hero_id")
dota2_data <- dota2_data %>%
  mutate(
    kda_ratio = ifelse(deaths == 0, kills + assists, (kills + assists) / deaths),
    exp = case_when(
      level == 1 ~ 0,
      level == 2 ~ 240,
      level == 3 ~ 640,
      level == 4 ~ 1160,
      level == 5 ~ 1760,
      level == 6 ~ 2440,
      level == 7 ~ 3200,
      level == 8 ~ 4000,
      level == 9 ~ 4900,
      level == 10 ~ 5900,
      level == 11 ~ 7000,
      level == 12 ~ 8200,
      level == 13 ~ 9500,
      level == 14 ~ 10900,
      level == 15 ~ 12400,
      level == 16 ~ 14000,
      level == 17 ~ 15700,
      level == 18 ~ 17500,
      level == 19 ~ 19400,
      level == 20 ~ 21400,
      level == 21 ~ 23600,
      level == 22 ~ 26000,
      level == 23 ~ 28600,
      level == 24 ~ 31400,
      level == 25 ~ 34400,
      level == 26 ~ 38400,
      level == 27 ~ 43400,
      level == 28 ~ 49400,
      level == 29 ~ 56400,
      level == 30 ~ 63900
    ),
    start_time_unix = as.numeric(as.POSIXct(start_time, format="%Y-%m-%d %H:%M:%S", tz="UTC"))
  )
dota2_data <- dota2_data %>% select(-kills_log)
dota2_data <- dota2_data %>%
  mutate(kda_ratio = ifelse(deaths == 0, kills + assists, (kills + assists) / deaths)) %>%
  select(-kda)

# Функция для вычисления корреляции и p-value
get_correlations <- function(data) {
  corr_matrix <- cor(data %>% select(gold_per_min, assists, deaths, kills, last_hits, obs_placed, kda_ratio, exp, hero_healing), use = "complete.obs")
  p_values <- sapply(names(corr_matrix["gold_per_min", -1]), function(x) cor.test(data$gold_per_min, data[[x]])$p.value)
  list(correlation = corr_matrix["gold_per_min", -1], p_value = p_values)
}

# Разделение данных на подгруппы по медиане teamfight_participation
median_teamfight <- median(dota2_data$teamfight_participation, na.rm = TRUE)
low_teamfight_data <- dota2_data %>% filter(teamfight_participation < median_teamfight)
high_teamfight_data <- dota2_data %>% filter(teamfight_participation >= median_teamfight)
```


``` {r q14.1}
# Q14.1: Корреляции для группы с teamfight_participation < медианы
low_teamfight_correlations <- get_correlations(low_teamfight_data)
low_teamfight_top_correlations <- sort(low_teamfight_correlations$correlation, decreasing = TRUE)[1:3]
low_teamfight_top_correlations_pvalues <- low_teamfight_correlations$p_value[names(low_teamfight_top_correlations)]

# Q14.2: Корреляции для группы с teamfight_participation >= медианы
high_teamfight_correlations <- get_correlations(high_teamfight_data)
high_teamfight_top_correlations <- sort(high_teamfight_correlations$correlation, decreasing = TRUE)[1:3]
high_teamfight_top_correlations_pvalues <- high_teamfight_correlations$p_value[names(high_teamfight_top_correlations)]

```


``` {r q14.2}
# Q14.3: Сравнение результатов между группами
# Вывод результатов
cat("Q14.1: Корреляции для группы с teamfight_participation < медианы\n")
print(low_teamfight_top_correlations)
print(low_teamfight_top_correlations_pvalues)
```

Наиболее высокие корреляции с переменной gold_per_min у героев с низким участием в командных боях (teamfight_participation < медианы) наблюдаются для следующих переменных:

last_hits: 0.8412053
exp: 0.6919248
kills: 0.6426595

Значения p-value для этих корреляций равны 0, что указывает на их статистическую значимость при уровне значимости α = 0.05. Это говорит о том, что количество добитых крипов (last_hits), опыт (exp) и количество убийств (kills) вносят значительный вклад в уровень заработка золота в минуту (gold_per_min) для героев, которые менее активно участвуют в командных боях.

``` {r q14.3}
cat("\nQ14.2: Корреляции для группы с teamfight_participation >= медианы\n")
print(high_teamfight_top_correlations)
print(high_teamfight_top_correlations_pvalues)
```

Для героев с высоким участием в командных боях (teamfight_participation >= медианы), наибольшие корреляции с переменной gold_per_min наблюдаются для следующих переменных:

last_hits: 0.8100713
kills: 0.7358739
exp: 0.6767167

Значения p-value для этих корреляций также равны 0, что указывает на их статистическую значимость при уровне значимости α = 0.05. Это говорит о том, что количество добитых крипов (last_hits), количество убийств (kills) и опыт (exp) вносят значительный вклад в уровень заработка золота в минуту (gold_per_min) для героев, которые более активно участвуют в командных боях.

``` {r q14.4}
cat("\nQ14.3: Сравнение результатов между группами\n")
cat("Группа с низкой teamfight_participation:\n")
print(low_teamfight_top_correlations)
cat("Группа с высокой teamfight_participation:\n")
print(high_teamfight_top_correlations)
```
Сравнение результатов показывает следующие наблюдения:

Группа с низкой teamfight_participation:

last_hits: 0.8412053
exp: 0.6919248
kills: 0.6426595
Группа с высокой teamfight_participation:

last_hits: 0.8100713
kills: 0.7358739
exp: 0.6767167

В обеих группах наибольшую корреляцию с gold_per_min показывает переменная last_hits (количество добитых крипов). Это ожидаемо, так как добивание крипов является основным источником золота в игре.
Переменные exp (опыт) и kills (убийства) также показывают высокие корреляции с gold_per_min в обеих группах, что подтверждает важность этих факторов для получения золота.


Различия между группами:

В группе с низким участием в командных боях (teamfight_participation < медианы) переменная last_hits показывает более высокую корреляцию с gold_per_min (0.8412053) по сравнению с группой с высоким участием в командных боях (0.8100713). Это может быть связано с тем, что герои, которые менее активно участвуют в командных боях, больше фокусируются на фарме крипов для получения золота.

В группе с высоким участием в командных боях переменная kills имеет более высокую корреляцию с gold_per_min (0.7358739) по сравнению с группой с низким участием (0.6426595). Это может быть связано с тем, что герои, которые больше участвуют в командных боях, получают значительную часть своего золота за счет убийств врагов.

``` {r q14.5}
healing_group <- dota2_data %>% filter(hero_healing > 0)
non_healing_group <- dota2_data %>% filter(hero_healing == 0)

t_test_healing <- t.test(healing_group$gold_per_min, non_healing_group$gold_per_min)
```

Q15

``` {r q15}
# Q15.1: Корреляции для ближнего типа атаки
melee_top_correlations <- sort(melee_correlations$correlation, decreasing = TRUE)[1:3]
melee_top_correlations_pvalues <- melee_correlations$p_value[names(melee_top_correlations)]

# Q15.2: Корреляции для дальнего типа атаки
ranged_top_correlations <- sort(ranged_correlations$correlation, decreasing = TRUE)[1:3]
ranged_top_correlations_pvalues <- ranged_correlations$p_value[names(ranged_top_correlations)]

# Вывод результатов
cat("Q15.1: Корреляции для ближнего типа атаки\n")
print(melee_top_correlations)
print(melee_top_correlations_pvalues)

cat("\nQ15.2: Корреляции для дальнего типа атаки\n")
print(ranged_top_correlations)
print(ranged_top_correlations_pvalues)

# Q15.3: Сравнение результатов
cat("\nQ15.3: Сравнение результатов между группами\n")
cat("Ближний тип атаки:\n")
print(melee_top_correlations)
cat("Дальний тип атаки:\n")
print(ranged_top_correlations)

```

Q15.1

Три переменные, которые лучше всего коррелируют с `gold_per_min` для героев с ближним типом атаки, это:

1. `last_hits` (коэффициент корреляции \( r = 0.776 \), \( p \)-значение < 0.001)

2. `kills` (коэффициент корреляции \( r = 0.666 \), \( p \)-значение < 0.001)

3. `exp` (коэффициент корреляции \( r = 0.664 \), \( p \)-значение < 0.001)



Q15.2

Три переменные, которые лучше всего коррелируют с gold_per_min для героев с дальним типом атаки, это:

last_hits (коэффициент корреляции 𝑟 = 0.847 p-значение < 0.001)

kills (коэффициент корреляции 𝑟= 0.718 p-значение < 0.001)

exp (коэффициент корреляции 𝑟 = 0.692 p-значение < 0.001)


Q15.3

Результаты в подгруппах (герои с ближним и дальним типами атаки) показывают, что:

Для обоих типов атаки переменные last_hits, kills и exp наиболее сильно коррелируют с gold_per_min.

Корреляции для героев с дальним типом атаки немного выше, чем для героев с ближним типом атаки.

Q16

``` {r q16.1}
# Фильтрация данных по центральной линии (lane == 2)
mid_lane_data <- dota2_data %>% filter(lane == 2)

# Разделение данных на ближний и дальний типы атаки для центральной линии
mid_melee_data <- mid_lane_data %>% filter(attack_type == "Melee")
mid_ranged_data <- mid_lane_data %>% filter(attack_type == "Ranged")

# Функция для вычисления корреляции и p-value
get_correlations <- function(data) {
  corr_matrix <- cor(data %>% select(gold_per_min, assists, deaths, kills, last_hits, obs_placed, kda_ratio, exp, hero_healing), use = "complete.obs")
  p_values <- sapply(names(corr_matrix["gold_per_min", -1]), function(x) cor.test(data$gold_per_min, data[[x]])$p.value)
  list(correlation = corr_matrix["gold_per_min", -1], p_value = p_values)
}

# Вычисление корреляций для ближнего типа атаки на центральной линии
mid_melee_correlations <- get_correlations(mid_melee_data)

# Вычисление корреляций для дальнего типа атаки на центральной линии
mid_ranged_correlations <- get_correlations(mid_ranged_data)
```

``` {r q16.2}
# Q16.1: Корреляции для ближнего типа атаки на центральной линии
mid_melee_top_correlations <- sort(mid_melee_correlations$correlation, decreasing = TRUE)[1:3]
mid_melee_top_correlations_pvalues <- mid_melee_correlations$p_value[names(mid_melee_top_correlations)]

# Q16.2: Корреляции для дальнего типа атаки на центральной линии
mid_ranged_top_correlations <- sort(mid_ranged_correlations$correlation, decreasing = TRUE)[1:3]
mid_ranged_top_correlations_pvalues <- mid_ranged_correlations$p_value[names(mid_ranged_top_correlations)]

# Вывод результатов для центральной линии
cat("Q16.1: Корреляции для ближнего типа атаки на центральной линии\n")
print(mid_melee_top_correlations)
print(mid_melee_top_correlations_pvalues)

cat("\nQ16.2: Корреляции для дальнего типа атаки на центральной линии\n")
print(mid_ranged_top_correlations)
print(mid_ranged_top_correlations_pvalues)

# Q16.3: Сравнение результатов между группами на центральной линии
cat("\nQ16.3: Сравнение результатов между группами на центральной линии\n")
cat("Ближний тип атаки:\n")
print(mid_melee_top_correlations)
cat("Дальний тип атаки:\n")
print(mid_ranged_top_correlations)

# Q16.4: Обоснование выбора новых подгрупп
cat("\nQ16.4: Обоснование выбора новых подгрупп\n")
cat("Выбор подгрупп героев, стоящих на центральной линии, обусловлен тем, что центральная линия является ключевой позицией в игре Dota 2. Герои на этой линии часто получают больше опыта и золота, что позволяет более точно оценить их влияние на игровой процесс. Кроме того, сравнение ближних и дальних бойцов на центральной линии помогает выявить специфические игровые стратегии и стили игры.")
```

Q17

``` {r q17}
dota2_data_path <- "C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv"
level_exp_path <- "C:\\Users\\Егор\\Downloads\\rppd\\level_exp.json"
heroes_data_path <- "C:\\Users\\Егор\\Downloads\\rppd\\heroes.csv"
dota2_data <- read.csv(dota2_data_path)
heroes_data <- read.csv(heroes_data_path)
level_exp <- fromJSON(level_exp_path)
level_exp_df <- data.frame(level = as.numeric(names(level_exp)), exp = unlist(level_exp))
dota2_data <- dota2_data %>%
  left_join(level_exp_df, by = c("level" = "level"))
dota2_data <- dota2_data %>%
  left_join(heroes_data, by = c("hero_id" = "id"))

# Преобразование переменных isRadiant и radiant_win в фактор
dota2_data$isRadiant <- as.factor(dota2_data$isRadiant)
dota2_data$radiant_win <- as.factor(ifelse(dota2_data$radiant_win == "True", 1, 0))

# Создание переменной healing_zero
dota2_data <- dota2_data %>%
  mutate(healing_zero = ifelse(hero_healing == 0, 1, 0))

# Выделение данных по победам для светлой и темной стороны
radiant_wins <- dota2_data %>%
  filter(isRadiant == 1) %>%
  summarise(wins = sum(radiant_win == 1) / n())

dire_wins <- dota2_data %>%
  filter(isRadiant == 0) %>%
  summarise(wins = sum(radiant_win == 0) / n())

# Проведение двухвыборочного t-теста
t_test_result <- t.test(as.numeric(dota2_data$radiant_win) ~ dota2_data$isRadiant)

# Вывод результатов
cat("p-value для гипотезы о вероятности победы в зависимости от стороны:", t_test_result$p.value, "\n")
if (t_test_result$p.value < 0.05) {
  cat("H0 отклоняется: вероятность победы зависит от стороны.\n")
} else {
  cat("H0 не отклоняется: вероятность победы не зависит от стороны.\n")
}

# Проведение тестов для gold_per_min
# Группы: melee_attack = 1 vs ranged_attack = 1
melee_vs_ranged <- dota2_data %>%
  filter(attack_type %in% c("Melee", "Ranged")) %>%
  mutate(attack_group = ifelse(attack_type == "Melee", 1, 0))

t_test_melee_ranged <- t.test(gold_per_min ~ attack_group, data = melee_vs_ranged)
cat("p-value для gold_per_min (melee_attack = 1 vs ranged_attack = 1):", t_test_melee_ranged$p.value, "\n")
if (t_test_melee_ranged$p.value < 0.05) {
  cat("H0 отклоняется: средняя величина gold_per_min отличается между melee_attack и ranged_attack.\n")
} else {
  cat("H0 не отклоняется: средняя величина gold_per_min не отличается между melee_attack и ranged_attack.\n")
}

# Группы: healing_zero = 1 vs healing_zero = 0
healing_zero_groups <- dota2_data %>%
  filter(!is.na(healing_zero))

t_test_healing_zero <- t.test(gold_per_min ~ healing_zero, data = healing_zero_groups)
cat("p-value для gold_per_min (healing_zero = 1 vs healing_zero = 0):", t_test_healing_zero$p.value, "\n")
if (t_test_healing_zero$p.value < 0.05) {
  cat("H0 отклоняется: средняя величина gold_per_min отличается между healing_zero = 1 и healing_zero = 0.\n")
} else {
  cat("H0 не отклоняется: средняя величина gold_per_min не отличается между healing_zero = 1 и healing_zero = 0.\n")
}


```

Q18
``` {r q18.1}
dota2_data <- read.csv("C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv")
dota2_data <- dota2_data %>%
  select(-c(X, player_slot, account_id, additional_units, patch, region, lose, radiant_win))
dota2_data <- dota2_data %>%
  filter(game_mode == 2) %>%
  na.omit()
heroes_data <- read.csv("C:\\Users\\Егор\\Downloads\\rppd\\heroes.csv")
heroes_data <- heroes_data %>%
  rename(hero_id = id)
dota2_data <- dota2_data %>%
  left_join(heroes_data, by = "hero_id")
dota2_data <- dota2_data %>%
  mutate(
    kda_ratio = ifelse(deaths == 0, kills + assists, (kills + assists) / deaths),
    exp = case_when(
      level == 1 ~ 0,
      level == 2 ~ 240,
      level == 3 ~ 640,
      level == 4 ~ 1160,
      level == 5 ~ 1760,
      level == 6 ~ 2440,
      level == 7 ~ 3200,
      level == 8 ~ 4000,
      level == 9 ~ 4900,
      level == 10 ~ 5900,
      level == 11 ~ 7000,
      level == 12 ~ 8200,
      level == 13 ~ 9500,
      level == 14 ~ 10900,
      level == 15 ~ 12400,
      level == 16 ~ 14000,
      level == 17 ~ 15700,
      level == 18 ~ 17500,
      level == 19 ~ 19400,
      level == 20 ~ 21400,
      level == 21 ~ 23600,
      level == 22 ~ 26000,
      level == 23 ~ 28600,
      level == 24 ~ 31400,
      level == 25 ~ 34400,
      level == 26 ~ 38400,
      level == 27 ~ 43400,
      level == 28 ~ 49400,
      level == 29 ~ 56400,
      level == 30 ~ 63900
    )
  )
melee_data <- dota2_data %>% filter(attack_type == "Melee")
ranged_data <- dota2_data %>% filter(attack_type == "Ranged")

# Используем непараметрический тест Манна-Уитни для сравнения двух групп
wilcox_test <- wilcox.test(melee_data$gold_per_min, ranged_data$gold_per_min)
p_value <- wilcox_test$p.value

# Сравнение средних значений
mean_melee <- mean(melee_data$gold_per_min, na.rm = TRUE)
mean_ranged <- mean(ranged_data$gold_per_min, na.rm = TRUE)

# Вывод результатов
cat("Q18: Сравнение групп по типу атаки\n")
cat("p-value =", p_value, "\n")
if (p_value < 0.05) {
  cat("Нулевая гипотеза отвергнута.\n")
  if (mean_melee > mean_ranged) {
    cat("Средний показатель gold_per_min выше в группе melee.\n")
  } else {
    cat("Средний показатель gold_per_min выше в группе ranged.\n")
  }
} else {
  cat("Нулевая гипотеза не отвергнута. Средние показатели gold_per_min в обеих группах не различаются.\n")
}


```

p-value: Значение p-value равно 0, что указывает на высокую статистическую значимость. Это означает, что вероятность того, что различия в среднем значении gold_per_min между группами melee и ranged произошли случайно, практически равна нулю.

Отклонение H0: Нулевая гипотеза (H0), которая утверждает, что нет различий в среднем значении gold_per_min между героями с ближней атакой (melee) и героями с дальней атакой (ranged), отвергнута. Это означает, что различия действительно существуют.

Средний показатель gold_per_min: Средний показатель gold_per_min выше в группе melee. Это может быть связано с несколькими факторами:

Игровая роль и стиль игры: Герои с ближней атакой часто играют более агрессивно, ведут активную охоту на врагов и участвуют в драках, что может привести к большему количеству золота в минуту.
Особенности героев: Герои ближнего боя могут иметь способности или таланты, которые позволяют им быстрее убивать крипов или героев, что увеличивает их золото.

Позиционирование на линии: Герои ближнего боя могут находиться на линиях, где у них больше возможностей для фарма и убийства врагов.


Q19: Выводы

 
``` {r q19}
p_value_healing <- t_test_healing$p.value
mean_healing <- mean(healing_group$gold_per_min)
mean_non_healing <- mean(non_healing_group$gold_per_min)

# Вывод результатов
cat("Q19: Сравнение групп по наличию лечения союзников\n")
cat("p-value =", p_value_healing, "\n")
if (p_value_healing < 0.05) {
  cat("Нулевая гипотеза отвергается.\n")
  if (mean_healing > mean_non_healing) {
    cat("Показатель gold_per_min в группе с лечением выше.\n")
  } else {
    cat("Показатель gold_per_min в группе без лечения выше.\n")
  }
} else {
  cat("Нулевая гипотеза не отвергается.\n")
}

cat("Как вы думаете, почему вы получили такой результат?\n")
cat("Могло быть так, что герои с лечением фокусировались на поддержке команды, что могло привести к различию в показателях gold_per_min.\n")
```



``` {r q19.1}
# Проверка количества строк после фильтрации
cat("Количество строк после фильтрации: ", nrow(dota2_data), "\n")

# Проверка наличия нечисловых значений в данных
cat("Проверка наличия нечисловых значений:\n")
summary(dota2_data)
```


``` {r q19.2}
# Модели с логарифмом и корнем с использованием log1p для избежания проблем с нулями
model_log <- lm(gold_per_min ~ log1p(assists) + log1p(deaths) + log1p(kills) + log1p(last_hits) + log1p(obs_placed) + log1p(kda_ratio) + log1p(exp) + log1p(hero_healing), data = dota2_data)
model_sqrt <- lm(gold_per_min ~ sqrt(assists) + sqrt(deaths) + sqrt(kills) + sqrt(last_hits) + sqrt(obs_placed) + sqrt(kda_ratio) + sqrt(exp) + sqrt(hero_healing), data = dota2_data)


```


``` {r q19.3}
# Вычисление значений R^2
r_squared_log <- summary(model_log)$r.squared
adj_r_squared_log <- summary(model_log)$adj.r.squared
r_squared_sqrt <- summary(model_sqrt)$r.squared
adj_r_squared_sqrt <- summary(model_sqrt)$adj.r.squared
```


``` {r q19.4}
# Интерпретация коэффициентов
coefficients_log <- summary(model_log)$coefficients
coefficients_sqrt <- summary(model_sqrt)$coefficients

# Стандартизация непрерывных переменных
dota2_data_standardized <- dota2_data %>%
  mutate_at(vars(assists, deaths, kills, last_hits, obs_placed, kda_ratio, exp, hero_healing), scale)

# Модели с стандартизированными переменными
model_standardized <- lm(gold_per_min ~ assists + deaths + kills + last_hits + obs_placed + kda_ratio + exp + hero_healing, data = dota2_data_standardized)
summary_model_standardized <- summary(model_standardized)
```

Q20


``` {r q20}
# Разделение данных по линиям
lane_1_data <- dota2_data %>% filter(lane == 1)
lane_2_data <- dota2_data %>% filter(lane == 2)
lane_3_data <- dota2_data %>% filter(lane == 3)

# Проведение t-тестов
t_test_1_2 <- t.test(lane_1_data$gold_per_min, lane_2_data$gold_per_min)
t_test_1_3 <- t.test(lane_1_data$gold_per_min, lane_3_data$gold_per_min)
t_test_2_3 <- t.test(lane_2_data$gold_per_min, lane_3_data$gold_per_min)

# Q20.1: Проверка гипотезы о равенстве средних
# H0: Средние значения gold_per_min равны для всех линий
# Альтернативная гипотеза: Средние значения gold_per_min не равны для всех линий
alpha <- 0.05

# Вывод результатов t-тестов
cat("Q20.1: Проведение парных двусторонних t-тестов\n")
cat("Результаты t-тестов между линиями:\n")
cat("Lane 1 vs Lane 2: p-value =", t_test_1_2$p.value, "\n")
cat("Lane 1 vs Lane 3: p-value =", t_test_1_3$p.value, "\n")
cat("Lane 2 vs Lane 3: p-value =", t_test_2_3$p.value, "\n")

# Отклонение H0
cat("\nОтклонение H0:\n")
if (t_test_1_2$p.value < alpha) {
  cat("Между Lane 1 и Lane 2 существует статистически значимая разница.\n")
} else {
  cat("Между Lane 1 и Lane 2 нет статистически значимой разницы.\n")
}
if (t_test_1_3$p.value < alpha) {
  cat("Между Lane 1 и Lane 3 существует статистически значимая разница.\n")
} else {
  cat("Между Lane 1 и Lane 3 нет статистически значимой разницы.\n")
}
if (t_test_2_3$p.value < alpha) {
  cat("Между Lane 2 и Lane 3 существует статистически значимая разница.\n")
} else {
  cat("Между Lane 2 и Lane 3 нет статистически значимой разницы.\n")
}

# Q20.2 p-value для каждой пары сравнений
cat("\nQ20.2: p-value для каждой пары сравнений\n")
cat("Lane 1 vs Lane 2: p-value =", t_test_1_2$p.value, "\n")
cat("Lane 1 vs Lane 3: p-value =", t_test_1_3$p.value, "\n")
cat("Lane 2 vs Lane 3: p-value =", t_test_2_3$p.value, "\n")

# Q20.3
cat("\nQ20.3: Интерпретация результатов\n")
cat("Полученные результаты могут быть связаны с различиями в игровых стратегиях и особенностями каждой линии. Например, на лёгкой линии (easy lane) игроки могут безопаснее получать золото и опыт, что приводит к более высоким значениям gold_per_min. На сложной линии (hard lane) игроки сталкиваются с большим количеством угроз, что может снижать их эффективность в получении золота и опыта. Эти различия могут объяснять значимые различия между линиями.\n")

```

Q21

``` {r q21}
# Пути к файлам
dota2_data_path <- "C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv"
level_exp_path <- "C:\\Users\\Егор\\Downloads\\rppd\\level_exp.json"
heroes_data_path <- "C:\\Users\\Егор\\Downloads\\rppd\\heroes.csv"

# Чтение данных из CSV файлов
dota2_data <- read.csv(dota2_data_path)
heroes_data <- read.csv(heroes_data_path)

# Чтение данных из JSON файла
level_exp <- fromJSON(level_exp_path)

# Преобразование JSON в data frame
level_exp_df <- data.frame(level = as.numeric(names(level_exp)), exp = unlist(level_exp))

# Объединение данных по уровню опыта
dota2_data <- dota2_data %>%
  left_join(level_exp_df, by = c("level" = "level"))

# Добавление информации о героях
dota2_data <- dota2_data %>%
  left_join(heroes_data, by = c("hero_id" = "id"))

# Создание групп на основе primary_attr
dota2_data <- dota2_data %>%
  mutate(
    str_attr = ifelse(primary_attr == "str", 1, 0),
    agi_attr = ifelse(primary_attr == "agi", 1, 0),
    int_attr = ifelse(primary_attr == "int", 1, 0),
    all_attr = ifelse(primary_attr == "all", 1, 0)
  )

# Функция для проведения t-теста между двумя группами
perform_t_test <- function(data, group1, group2) {
  group1_data <- data %>% filter(get(group1) == 1)
  group2_data <- data %>% filter(get(group2) == 1)
  
  t_test_result <- t.test(group1_data$gold_per_min, group2_data$gold_per_min, paired = FALSE)
  return(t_test_result)
}

# Проведение t-тестов для всех пар групп
tests <- list()
groups <- c("str_attr", "agi_attr", "int_attr", "all_attr")

for (i in 1:(length(groups) - 1)) {
  for (j in (i + 1):length(groups)) {
    group1 <- groups[i]
    group2 <- groups[j]
    test_result <- perform_t_test(dota2_data, group1, group2)
    tests[[paste(group1, group2, sep = "_vs_")]] <- test_result
  }
}

# Вывод результатов
cat("Результаты t-тестов:\n")
for (test_name in names(tests)) {
  cat("\n", test_name, "\n")
  cat("p-value:", tests[[test_name]]$p.value, "\n")
  if (tests[[test_name]]$p.value < 0.05) {
    cat("H0 отклоняется: есть значимая разница.\n")
  } else {
    cat("H0 не отклоняется: нет значимой разницы.\n")
  }
}

```

Q22

``` {r q22}
dota2_data_path <- "C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv"
level_exp_path <- "C:\\Users\\Егор\\Downloads\\rppd\\level_exp.json"
heroes_data_path <- "C:\\Users\\Егор\\Downloads\\rppd\\heroes.csv"
dota2_data <- read.csv(dota2_data_path)
heroes_data <- read.csv(heroes_data_path)
level_exp <- fromJSON(level_exp_path)
level_exp_df <- data.frame(level = as.numeric(names(level_exp)), exp = unlist(level_exp))
dota2_data <- dota2_data %>%
  left_join(level_exp_df, by = c("level" = "level")) %>%
  select(-level)
dota2_data <- dota2_data %>%
  left_join(heroes_data %>%
              select(id, attack_type, primary_attr), by = c("hero_id" = "id")) %>%
  mutate(
    ranged_attack = ifelse(attack_type == "Ranged", 1, 0),
    melee_attack = ifelse(attack_type == "Melee", 1, 0),
    str_attr = ifelse(primary_attr == "str", 1, 0),
    agi_attr = ifelse(primary_attr == "agi", 1, 0),
    int_attr = ifelse(primary_attr == "int", 1, 0),
    all_attr = ifelse(primary_attr == "all", 1, 0),
    hero_healing = ifelse(hero_healing == 0, 1, 0),
    healing_zero = ifelse(hero_healing == 0, 1, 0),
    lane_1 = ifelse(lane == 1, 1, 0),
    lane_2 = ifelse(lane == 2, 1, 0),
    lane_3 = ifelse(lane == 3, 1, 0)
  ) %>%
  select(-attack_type, -primary_attr, -lane)
dota2_data$start_time <- as.POSIXct(dota2_data$start_time)

# Проверка наличия необходимых переменных
required_cols <- c("lane_3", "ranged_attack", "all_attr", "lane_1", "lane_2")

missing_cols <- setdiff(required_cols, names(dota2_data))
if(length(missing_cols) > 0) {
  cat("Создание недостающих переменных:", missing_cols, "\n")
  for (col in missing_cols) {
    dota2_data[[col]] <- 0
  }
}

# Удаление ненужных переменных
dota2_data <- dota2_data %>%
  select(-lane_3, -ranged_attack, -all_attr)

# Линейная регрессия с одной независимой переменной
single_var_model <- lm(gold_per_min ~ last_hits, data = dota2_data)
summary_single_var <- summary(single_var_model)

# Значение R² для модели с одной переменной
r_squared_single <- summary_single_var$r.squared

cat("Значение R² для модели с одной переменной:", r_squared_single, "\n")
cat("Модель объясняет", round(r_squared_single * 100, 2), "% изменчивости переменной gold_per_min.\n")

# Проверка длины всех переменных
n_obs <- nrow(dota2_data)
all_vars <- c("duration", "assists", "deaths", "kills", "teamfight_participation",
              "camps_stacked", "creeps_stacked", "last_hits", "lane_kills", "firstblood_claimed",
              "obs_placed", "observer_kills", "ancient_kills", "isRadiant",
              "win", "kda", "exp", "lane_1", "lane_2", "str_attr",
              "agi_attr", "int_attr", "melee_attack", "hero_healing", "healing_zero")

# Убедиться, что все переменные имеют одинаковую длину
for (var in all_vars) {
  if (length(dota2_data[[var]]) != n_obs) {
    stop(paste("Переменная", var, "имеет разную длину."))
  }
}

# Линейная регрессия со всеми переменными
full_model <- lm(gold_per_min ~ duration + assists + deaths + kills + teamfight_participation +
                   camps_stacked + creeps_stacked + last_hits + lane_kills + firstblood_claimed +
                   obs_placed + observer_kills + ancient_kills + isRadiant +
                   win + kda + exp + lane_1 + lane_2 + str_attr +
                   agi_attr + int_attr + melee_attack + hero_healing + healing_zero,
                 data = dota2_data)

summary_full <- summary(full_model)

# Значение R² для полной модели
r_squared_full <- summary_full$r.squared

cat("Значение R² для полной модели:", r_squared_full, "\n")
cat("Полная модель объясняет", round(r_squared_full * 100, 2), "% изменчивости переменной gold_per_min.\n")

# Значимость коэффициентов
significant_coefficients <- summary_full$coefficients[, 4] < 0.05
significant_vars <- names(summary_full$coefficients[significant_coefficients, 1])

cat("Значимые переменные при α=0.05:\n")
print(significant_vars)

# Интерпретация значимых коэффициентов
cat("Интерпретация значимых коэффициентов:\n")
print(summary_full$coefficients[significant_coefficients, ])

```
Q23

``` {r q23}
dota2_data_path <- "C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv"
level_exp_path <- "C:\\Users\\Егор\\Downloads\\rppd\\level_exp.json"
heroes_data_path <- "C:\\Users\\Егор\\Downloads\\rppd\\heroes.csv"
dota2_data <- read.csv(dota2_data_path)
heroes_data <- read.csv(heroes_data_path)
level_exp <- fromJSON(level_exp_path)
level_exp_df <- data.frame(level = as.numeric(names(level_exp)), exp = unlist(level_exp))
dota2_data <- dota2_data %>%
  left_join(level_exp_df, by = c("level" = "level")) %>%
  select(-level)
dota2_data <- dota2_data %>%
  left_join(heroes_data %>%
              select(id, attack_type, primary_attr), by = c("hero_id" = "id")) %>%
  mutate(
    ranged_attack = ifelse(attack_type == "Ranged", 1, 0),
    melee_attack = ifelse(attack_type == "Melee", 1, 0),
    str_attr = ifelse(primary_attr == "str", 1, 0),
    agi_attr = ifelse(primary_attr == "agi", 1, 0),
    int_attr = ifelse(primary_attr == "int", 1, 0),
    all_attr = ifelse(primary_attr == "all", 1, 0),
    hero_healing = ifelse(hero_healing == 0, 1, 0),
    healing_zero = ifelse(hero_healing == 0, 1, 0),
    lane_1 = ifelse(lane == 1, 1, 0),
    lane_2 = ifelse(lane == 2, 1, 0),
    lane_3 = ifelse(lane == 3, 1, 0)
  ) %>%
  select(-attack_type, -primary_attr, -lane)
dota2_data$start_time <- as.POSIXct(dota2_data$start_time)

# Проверка наличия необходимых переменных
required_cols <- c("lane_3", "ranged_attack", "all_attr", "lane_1", "lane_2")

missing_cols <- setdiff(required_cols, names(dota2_data))
if(length(missing_cols) > 0) {
  cat("Создание недостающих переменных:", missing_cols, "\n")
  for (col in missing_cols) {
    dota2_data[[col]] <- 0
  }
}

# Удаление ненужных переменных
dota2_data <- dota2_data %>%
  select(-lane_3, -ranged_attack, -all_attr)

# Линейная регрессия с одной независимой переменной
single_var_model <- lm(gold_per_min ~ last_hits, data = dota2_data)
summary_single_var <- summary(single_var_model)

# Значение R² для модели с одной переменной
r_squared_single <- summary_single_var$r.squared

cat("Значение R² для модели с одной переменной:", r_squared_single, "\n")
cat("Модель объясняет", round(r_squared_single * 100, 2), "% изменчивости переменной gold_per_min.\n")

# Проверка длины всех переменных
n_obs <- nrow(dota2_data)
all_vars <- c("duration", "assists", "deaths", "kills", "teamfight_participation",
              "camps_stacked", "creeps_stacked", "last_hits", "lane_kills", "firstblood_claimed",
              "obs_placed", "observer_kills", "ancient_kills", "isRadiant",
              "win", "kda", "exp", "lane_1", "lane_2", "str_attr",
              "agi_attr", "int_attr", "melee_attack", "hero_healing", "healing_zero")

# Убедиться, что все переменные имеют одинаковую длину
for (var in all_vars) {
  if (length(dota2_data[[var]]) != n_obs) {
    stop(paste("Переменная", var, "имеет разную длину."))
  }
}

# Линейная регрессия со всеми переменными
full_model <- lm(gold_per_min ~ duration + assists + deaths + kills + teamfight_participation +
                   camps_stacked + creeps_stacked + last_hits + lane_kills + firstblood_claimed +
                   obs_placed + observer_kills + ancient_kills + isRadiant +
                   win + kda + exp + lane_1 + lane_2 + str_attr +
                   agi_attr + int_attr + melee_attack + hero_healing + healing_zero,
                 data = dota2_data)

summary_full <- summary(full_model)

# Значение R² для полной модели
r_squared_full <- summary_full$r.squared
adj_r_squared_full <- summary_full$adj.r.squared

cat("Значение R² для полной модели:", r_squared_full, "\n")
cat("Полная модель объясняет", round(r_squared_full * 100, 2), "% изменчивости переменной gold_per_min.\n")
cat("Значение adj. R² для полной модели:", adj_r_squared_full, "\n")

# Значимость коэффициентов
significant_coefficients <- summary_full$coefficients[, 4] < 0.05
significant_vars <- names(summary_full$coefficients[significant_coefficients, 1])

cat("Значимые переменные при α=0.05:\n")
print(significant_vars)

# Интерпретация значимых коэффициентов
cat("Интерпретация значимых коэффициентов:\n")
print(summary_full$coefficients[significant_coefficients, ])

```
duration (-0.1056): Отрицательный коэффициент указывает на то, что с увеличением продолжительности игры золото в минуту уменьшается. Это может быть неожиданным, так как в долгих играх игроки имеют больше времени для фарма.
teamfight_participation (-23.6569): Снижение золота в минуту с увеличением участия в командных сражениях также кажется необычным, поскольку участие в командных боях часто приносит больше золота за счёт убийств и ассистов.
str_attr (13.1963) и agi_attr (20.6380): Высокие положительные значения для силовых и ловкостных героев показывают, что эти атрибуты вносят значительный вклад в золото в минуту. Однако отрицательное значение для int_attr (-8.1379) указывает на обратное влияние для интеллекта, что может быть неожиданным, учитывая, что многие герои с интеллектом также эффективны в фарме.

Значение R² для данной модели: 0.912808
Значение adj. R² для данной модели: 0.9127976
Значения R² и adj. R² значительно возросли по сравнению с моделью с одной переменной (где R² было 0.6771551). Это показывает, что полная модель объясняет гораздо большую часть изменчивости переменной gold_per_min.

Q24

``` {r q24}
# Вывод результатов для Q24.1
cat("Q24.1: Значения R^2 для моделей\n")
cat("Логарифмическая модель: R^2 =", r_squared_log, ", adj. R^2 =", adj_r_squared_log, "\n")
cat("Модель с корнем: R^2 =", r_squared_sqrt, ", adj. R^2 =", adj_r_squared_sqrt, "\n")
cat("Модель со стандартизированными переменными: R^2 =", summary_model_standardized$r.squared, ", adj. R^2 =", summary_model_standardized$adj.r.squared, "\n")

# Вывод результатов для Q24.2
cat("\nQ24.2: Интерпретация коэффициентов\n")
cat("Логарифмическая модель:\n")
print(coefficients_log)
cat("\nМодель с корнем:\n")
print(coefficients_sqrt)
cat("\nМодель со стандартизированными переменными:\n")
print(summary_model_standardized$coefficients)
```
Значение R^2 для модели с корнем является самым высоким, что указывает на то, что эта модель лучше всего объясняет вариацию переменной gold_per_min.
  
Логарифмическая модель имеет самое низкое значение R^2, но все же она довольно высока.

Модель со стандартизированными переменными имеет значение R^2 между логарифмической моделью и моделью с корнем.


В логарифмической модели отрицательные коэффициенты указывают на отрицательное влияние переменных на gold_per_min, а положительные — на положительное влияние.
В модели с корнем также наблюдаются аналогичные влияния, однако их значения отличаются.
В модели со стандартизированными переменными значения коэффициентов позволяют сравнить влияние разных переменных непосредственно.

Q25

``` {r q25}
dota2_data <- read.csv("C:\\Users\\Егор\\Downloads\\rppd\\dota2_proleague.csv")
dota2_data <- dota2_data %>%
  select(-c(X, player_slot, account_id, additional_units, patch, region, lose, radiant_win))
dota2_data <- dota2_data %>%
  filter(game_mode == 2) %>%
  na.omit()
heroes_data <- read.csv("C:\\Users\\Егор\\Downloads\\rppd\\heroes.csv")
heroes_data <- heroes_data %>%
  rename(hero_id = id)
dota2_data <- dota2_data %>%
  left_join(heroes_data, by = "hero_id")
dota2_data <- dota2_data %>%
  mutate(
    kda_ratio = ifelse(deaths == 0, kills + assists, (kills + assists) / deaths),
    exp = case_when(
      level == 1 ~ 0,
      level == 2 ~ 240,
      level == 3 ~ 640,
      level == 4 ~ 1160,
      level == 5 ~ 1760,
      level == 6 ~ 2440,
      level == 7 ~ 3200,
      level == 8 ~ 4000,
      level == 9 ~ 4900,
      level == 10 ~ 5900,
      level == 11 ~ 7000,
      level == 12 ~ 8200,
      level == 13 ~ 9500,
      level == 14 ~ 10900,
      level == 15 ~ 12400,
      level == 16 ~ 14000,
      level == 17 ~ 15700,
      level == 18 ~ 17500,
      level == 19 ~ 19400,
      level == 20 ~ 21400,
      level == 21 ~ 23600,
      level == 22 ~ 26000,
      level == 23 ~ 28600,
      level == 24 ~ 31400,
      level == 25 ~ 34400,
      level == 26 ~ 38400,
      level == 27 ~ 43400,
      level == 28 ~ 49400,
      level == 29 ~ 56400,
      level == 30 ~ 63900
    )
  )

# Регрессионный анализ для определения вклада переменных в GPM
model <- lm(gold_per_min ~ assists + deaths + kills + last_hits + obs_placed + kda_ratio + exp + hero_healing, data = dota2_data)

# Получение коэффициентов регрессии
coefficients <- summary(model)$coefficients

# Q25.1: Три переменные с наибольшим положительным вкладом
positive_contributors <- coefficients[order(coefficients[, "Estimate"], decreasing = TRUE), ][1:3, ]
positive_contributors

# Q25.2: Три переменные с наибольшим отрицательным вкладом
negative_contributors <- coefficients[order(coefficients[, "Estimate"]), ][1:3, ]
negative_contributors

# Вывод результатов
cat("Q25.1: Три переменные, вносящие наибольший положительный вклад в GPM:\n")
print(positive_contributors)
cat("\nОжидаемо ли это? Обоснование:\n")

# 1. Kills (Убийства): Убийства героев противника напрямую приносят золото игроку, поэтому их положительный вклад в GPM ожидаем и логичен.
# 2. Assists (Ассисты): Ассисты также приносят золото игроку, хотя и в меньшей степени, чем убийства, поэтому их положительный вклад в GPM также ожидаем.
# 3. Last_hits (Последние удары): Последние удары по крипам являются основным источником золота для героев, поэтому их значительный положительный вклад в GPM вполне ожидаем.

# Ответ: (Kills, Assists, Last_hits)
# Обоснование: Убийства и ассисты напрямую приносят золото, а последние удары по крипам являются основным источником золота.

cat("\nQ25.2: Три переменные, вносящие наибольший отрицательный вклад в GPM:\n")
print(negative_contributors)
cat("\nОжидаемо ли это? Обоснование:\n")

# 1. Deaths (Смерти): Смерти героя напрямую снижают его способность фармить золото, так как герой временно не может участвовать в игре и убивать крипов или героев, что объясняет их отрицательный вклад в GPM.
# 2. Obs_placed (Поставленные обсерверы): Поставленные обсерверы (варды) не напрямую связаны с фармом золота и могут даже отвлекать игрока от фарма, что объясняет их отрицательный вклад в GPM.
# 3. Hero_healing (Лечение героя): Лечение героя также не напрямую связано с фармом золота и может отвлекать от агрессивной игры и убийств, что объясняет их небольшой отрицательный вклад в GPM.

# Ответ: (Deaths, Obs_placed, Hero_healing)
# Обоснование: Смерти снижают способность фармить золото, поставленные обсерверы и лечение не связаны напрямую с фармом золота и могут отвлекать от агрессивной игры.

```


Q26

Q26: Выводы
Какие выводы можно сделать из проведенного анализа?

Наибольшее влияние на gold_per_min оказывают переменные last_hits, kills и exp, что подтверждается высокой корреляцией и значимостью в регрессиях.
Использование логарифмов и корней для скошенных переменных улучшает объяснительную способность модели.
Победа в игре и участие в командных боях также являются значимыми предикторами gold_per_min.
Что удалось сделать, а что не удалось?

Удалось:
Определить ключевые переменные, влияющие на gold_per_min.
Улучшить модель путем преобразования скошенных переменных.
Провести анализ значимости коэффициентов.
Не удалось:
Полностью устранить проблемы с разными длинами переменных без исключения данных.
Избежать ошибок при загрузке данных и их предобработке.


Как можно было бы улучшить работу?

Разбор подгрупп: Провести более детализированный анализ для различных подгрупп (например, по ролям героев, типу атаки, линии).
Больше данных: Включить дополнительные данные о матчах и героях для улучшения модели.
Другие переменные: Исследовать влияние дополнительных переменных, таких как предметы, приобретенные героями, и их действия в игре.
Дополнительные методы: Применить более сложные модели машинного обучения для более точного прогнозирования gold_per_min.